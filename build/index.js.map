{"version":3,"sources":["../src/index.js"],"names":["dbConfig","env","process","configApproved","hasOwnProperty","RABBITMQ_HOST","console","log","RABBITMQ_PORT","exit","amqp","connect","then","conn","DEBUG","$","set","catch","err","e","message"],"mappings":";;;;;;AAAA;;AACA;;;;;;kBAEe,YAAM;AACjB,QAAG;AACC,YAAIA,WAAW,EAAf;AACA,YAAIC,MAAMC,QAAQD,GAAlB;AACA,YAAIE,iBAAiB,IAArB;;AAEA,YAAG,CAACF,IAAIG,cAAJ,CAAmB,cAAnB,CAAJ,EAAuC;AACnC,gBAAGH,IAAIG,cAAJ,CAAmB,eAAnB,KAAuC,CAAC,CAACH,IAAII,aAAhD,EACIL,SAAS,eAAT,IAA4BC,IAAII,aAAhC,CADJ,KAEK;AACDF,iCAAiB,KAAjB;AACAG,wBAAQC,GAAR,CAAY,qEAAZ;AACH;;AAED,gBAAGN,IAAIG,cAAJ,CAAmB,eAAnB,KAAuC,CAAC,CAACH,IAAIO,aAAhD,EACIR,SAAS,eAAT,IAA4BC,IAAIO,aAAhC,CADJ,KAEK;AACDL,iCAAiB,KAAjB;AACAG,wBAAQC,GAAR,CAAY,qEAAZ;AACH;AACJ,SAdD,MAeI;AACAJ,6BAAiB,IAAjB;AACH;;AAED,YAAG,CAACA,cAAJ,EAAmB;AACfG,oBAAQC,GAAR,CAAY,mFAAZ;AACAL,oBAAQO,IAAR,CAAa,CAAC,CAAd;AACH,SAHD,MAIK;AACD,gBAAI;AACA,oBAAGR,IAAIG,cAAJ,CAAmB,cAAnB,CAAH,EAAsC;AAClCM,sCAAKC,OAAL,aAAuBV,IAAI,cAAJ,CAAvB,EAA8CW,IAA9C,CAAmD,UAACC,IAAD,EAAU;AACzD,4BAAGX,QAAQD,GAAR,CAAYa,KAAZ,IAAqB,MAAxB,EACIR,QAAQC,GAAR,CAAY,6CAAZ;;AAEJQ,iCAAEC,GAAF,CAAM,UAAN,EAAkBH,IAAlB;AACH,qBALD,EAKGI,KALH,CAKS,UAACC,GAAD,EAAS;AACdZ,gCAAQC,GAAR,qBAA8BW,GAA9B;AACH,qBAPD;AAQH,iBATD,MAUI;AACAR,sCAAKC,OAAL,aAAuBX,SAAS,eAAT,CAAvB,SAAoDA,SAAS,eAAT,CAApD,EAAiFY,IAAjF,CAAsF,UAACC,IAAD,EAAU;AAC5F,4BAAGX,QAAQD,GAAR,CAAYa,KAAZ,IAAqB,MAAxB,EACIR,QAAQC,GAAR,CAAY,6CAAZ;;AAEJQ,iCAAEC,GAAF,CAAM,UAAN,EAAkBH,IAAlB;AACH,qBALD,EAKGI,KALH,CAKS,UAACC,GAAD,EAAS;AACdZ,gCAAQC,GAAR,qBAA8BW,GAA9B;AACH,qBAPD;AAQH;AACJ,aArBD,CAsBA,OAAOC,CAAP,EAAU;AACNb,wBAAQC,GAAR,qBAA8BY,EAAEC,OAAhC;AACH;AACJ;AACJ,KAvDD,CAwDA,OAAOD,CAAP,EAAU;AACNb,gBAAQC,GAAR,qBAA8BY,EAAEC,OAAhC;AACH;AACJ,C","file":"index.js","sourcesContent":["import { $ } from \"@dekproject/scope\";\nimport amqp from \"amqplib\";\n\nexport default () => {\n    try{\n        let dbConfig = {};\n        let env = process.env;\n        let configApproved = true;\n\n        if(!env.hasOwnProperty(\"RABBITMQ_URI\")){\n            if(env.hasOwnProperty(\"RABBITMQ_HOST\") && !!env.RABBITMQ_HOST)\n                dbConfig[\"RABBITMQ_HOST\"] = env.RABBITMQ_HOST;\n            else {\n                configApproved = false;\n                console.log(\"[ RabbitMQ ] - There is no RABBITMQ_HOST variable in the .env file.\");\n            }\n\n            if(env.hasOwnProperty(\"RABBITMQ_PORT\") && !!env.RABBITMQ_PORT)\n                dbConfig[\"RABBITMQ_PORT\"] = env.RABBITMQ_PORT;\n            else {\n                configApproved = false;\n                console.log(\"[ RabbitMQ ] - There is no RABBITMQ_PORT variable in the .env file.\");\n            }\n        }\n        else{\n            configApproved = true;\n        }\n\n        if(!configApproved){\n            console.log(\"[ RabbitMQ ] - Please correct the above errors before restarting the application.\");\n            process.exit(-1);\n        }\n        else {\n            try {\n                if(env.hasOwnProperty(\"RABBITMQ_URI\")){\n                    amqp.connect(`amqp://${env[\"RABBITMQ_URI\"]}`).then((conn) => {\n                        if(process.env.DEBUG == \"true\")\n                            console.log(\"[ RabbitMQ ] - RabbitMQ successfully signed\");\n\n                        $.set(\"rabbitmq\", conn);                        \n                    }).catch((err) => {\n                        console.log(`[ RabbitMQ ] - ${err}`);\n                    });\n                }\n                else{\n                    amqp.connect(`amqp://${dbConfig[\"RABBITMQ_HOST\"]}:${dbConfig[\"RABBITMQ_PORT\"]}`).then((conn) => {\n                        if(process.env.DEBUG == \"true\")\n                            console.log(\"[ RabbitMQ ] - RabbitMQ successfully signed\");\n\n                        $.set(\"rabbitmq\", conn);\n                    }).catch((err) => {\n                        console.log(`[ RabbitMQ ] - ${err}`);\n                    });\n                }\n            }\n            catch (e) {\n                console.log(`[ RabbitMQ ] - ${e.message}`);\n            }\n        }\n    }\n    catch (e) {\n        console.log(`[ RabbitMQ ] - ${e.message}`);\n    }\n};\n"]}